<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Tickets</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <style>
        /* Estilos personalizados para los botones */
        .btn-primary {
            @apply bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded;
        }
        .btn-secondary {
            @apply bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded;
        }
        .btn-success {
            @apply bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded;
        }
        .btn-danger {
            @apply bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded;
        }
        .btn-outline-primary {
            @apply bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 rounded;
        }
        .btn-outline-secondary {
            @apply bg-transparent hover:bg-gray-300 text-gray-700 font-semibold hover:text-gray-800 py-2 px-4 border border-gray-300 rounded;
        }
        .btn-outline-success {
            @apply bg-transparent hover:bg-green-500 text-green-700 font-semibold hover:text-white py-2 px-4 border border-green-500 rounded;
        }
        .btn-outline-danger {
            @apply bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-4 border border-red-500 rounded;
        }

        .form-label {
            @apply block text-gray-700 text-sm font-bold mb-2;
        }
        .form-input {
            @apply shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline;
        }
        .form-select {
            @apply shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline;
        }
        .table-auto {
            width: auto;
        }

        /* Nuevos estilos para dar color a la página */
        body {
            background-color: #f3e5f5; /* Color de fondo lavanda */
        }
        .container {
            background-color: #fff; /* Fondo blanco para el contenedor principal */
        }
        #login-page {
            background-color: #e0f7fa; /* Fondo azul claro para la página de login */
        }
        #register-page {
            background-color: #e8f5e9; /* Fondo verde claro para la página de registro */
        }
        #tickets-page {
            background-color: #f0f4c3; /* Fondo amarillo claro para la página de tickets */
        }
        #empresas-page {
            background-color: #f4e3cf; /* Fondo beige para la página de empresas */
        }
        #asesores-page {
            background-color: #d1c4e9; /* Fondo lila claro para la página de asesores */
        }
        #clientes-page {
            background-color: #c5e1e6; /* Fondo turquesa claro para la página de clientes */
        }
        #entity-forms {
            background-color: #fff; /* Fondo blanco para los formularios */
        }
        .form-container {
             background-color: #fff;
        }

    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-semibold text-center text-gray-800 mb-6">Sistema de Gestión de Tickets</h1>

        <div id="login-page" class="bg-white shadow-md rounded-lg p-8 max-w-md mx-auto">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Iniciar Sesión</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="form-label">Usuario:</label>
                    <input type="text" id="username" name="username" class="form-input" placeholder="Ingrese su usuario">
                </div>
                <div>
                    <label for="password" class="form-label">Contraseña:</label>
                    <input type="password" id="password" name="password" class="form-input" placeholder="Ingrese su contraseña">
                </div>
                <button type="submit" class="btn-primary w-full">Iniciar Sesión</button>
            </form>
            <div id="login-error" class="text-red-500 text-sm mt-4" style="display: none;"></div>
            <div class="mt-4 text-center">
                <button id="go-to-register" class="text-blue-500 hover:text-blue-700 font-semibold">¿No tienes una cuenta? Regístrate</button>
            </div>
        </div>

        <div id="register-page" class="bg-white shadow-md rounded-lg p-8 max-w-md mx-auto" style="display: none;">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Registro</h2>
            <form id="register-form" class="space-y-4">
                <div>
                    <label for="register-username" class="form-label">Usuario:</label>
                    <input type="text" id="register-username" name="username" class="form-input" placeholder="Ingrese su usuario">
                </div>
                <div>
                    <label for="register-password" class="form-label">Contraseña:</label>
                    <input type="password" id="register-password" name="password" class="form-input" placeholder="Ingrese su contraseña">
                </div>
                 <div>
                    <label for="register-nombre" class="form-label">Nombre:</label>
                    <input type="text" id="register-nombre" name="nombre" class="form-input" placeholder="Ingrese su nombre">
                </div>
                <div>
                    <label for="register-correo" class="form-label">Correo:</label>
                    <input type="email" id="register-correo" name="correo" class="form-input" placeholder="Ingrese su correo">
                </div>
                <button type="submit" class="btn-primary w-full">Registrar</button>
            </form>
            <div id="register-error" class="text-red-500 text-sm mt-4" style="display: none;"></div>
            <div class="mt-4 text-center">
                 <button id="go-to-login" class="text-blue-500 hover:text-blue-700 font-semibold">¿Ya tienes una cuenta? Inicia sesión</button>
            </div>
        </div>

        <div id="tickets-page" class="bg-white shadow-md rounded-lg p-8" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Tickets</h2>
                 <button id="add-ticket-button" class="btn-success">Nuevo Ticket</button>
            </div>
            <table id="tickets-table" class="min-w-full table-auto rounded-lg hidden">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2 text-left">ID Ticket</th>
                        <th class="px-4 py-2 text-left">Tipo de Ticket</th>
                        <th class="px-4 py-2 text-left">Quién Reporta</th>
                        <th class="px-4 py-2 text-left">Fecha</th>
                        <th class="px-4 py-2 text-left">Estatus</th>
                        <th class="px-4 py-2 text-left">Asesor que Atiende</th>
                        <th class="px-4 py-2 text-left">Empresa</th>
                        <th class="px-4 py-2 text-left">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700">
                </tbody>
            </table>
             <div id="no-tickets-message" class="text-gray-500 text-center mt-4">No hay tickets disponibles.</div>
        </div>

        <div id="empresas-page" class="bg-white shadow-md rounded-lg p-8" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Empresas</h2>
                <button id="add-empresa-button" class="btn-success">Nueva Empresa</button>
            </div>
            <table id="empresas-table" class="min-w-full table-auto rounded-lg hidden">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2 text-left">Nombre</th>
                        <th class="px-4 py-2 text-left">Dirección</th>
                        <th class="px-4 py-2 text-left">Teléfono</th>
                        <th class="px-4 py-2 text-left">Correo</th>
                        <th class="px-4 py-2 text-left">Nombre de Contacto</th>
                        <th class="px-4 py-2 text-left">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700">
                </tbody>
            </table>
            <div id="no-empresas-message" class="text-gray-500 text-center mt-4">No hay empresas disponibles.</div>
        </div>

        <div id="asesores-page" class="bg-white shadow-md rounded-lg p-8" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Asesores</h2>
                <button id="add-asesor-button" class="btn-success">Nuevo Asesor</button>
            </div>
            <table id="asesores-table" class="min-w-full table-auto rounded-lg hidden">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2 text-left">Nombre</th>
                        <th class="px-4 py-2 text-left">Teléfono</th>
                        <th class="px-4 py-2 text-left">Correo</th>
                        <th class="px-4 py-2 text-left">Número de Trabajador</th>
                        <th class="px-4 py-2 text-left">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700">
                </tbody>
            </table>
            <div id="no-asesores-message" class="text-gray-500 text-center mt-4">No hay asesores disponibles.</div>
        </div>

        <div id="clientes-page" class="bg-white shadow-md rounded-lg p-8" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Clientes</h2>
                <button id="add-cliente-button" class="btn-success">Nuevo Cliente</button>
            </div>
            <table id="clientes-table" class="min-w-full table-auto rounded-lg hidden">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2 text-left">Nombre</th>
                        <th class="px-4 py-2 text-left">Correo</th>
                        <th class="px-4 py-2 text-left">Empresa</th>
                        <th class="px-4 py-2 text-left">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700">
                </tbody>
            </table>
            <div id="no-clientes-message" class="text-gray-500 text-center mt-4">No hay clientes disponibles.</div>
        </div>

        <div id="entity-forms" style="display: none;">
            <div id="ticket-form" class="bg-white shadow-md rounded-lg p-8 max-w-md mx-auto form-container">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Formulario de Ticket</h2>
                <form id="ticket-main-form" class="space-y-4">
                    <div>
                        <label for="ticket-id" class="form-label">ID Ticket:</label>
                        <input type="text" id="ticket-id" name="id" class="form-input" placeholder="Ingrese ID del ticket" required>
                        <input type="hidden" id="ticket-edit-id">
                    </div>
                    <div>
                        <label for="ticket-tipo" class="form-label">Tipo de Ticket:</label>
                        <input type="text" id="ticket-tipo" name="tipo" class="form-input" placeholder="Ingrese tipo de ticket" required>
                    </div>
                    <div>
                        <label for="ticket-reporta" class="form-label">Quién Reporta:</label>
                        <input type="text" id="ticket-reporta" name="reporta" class="form-input" placeholder="Ingrese quién reporta" required>
                    </div>
                    <div>
                        <label for="ticket-fecha" class="form-label">Fecha:</label>
                        <input type="date" id="ticket-fecha" name="fecha" class="form-input" required>
                    </div>
                    <div>
                        <label for="ticket-estatus" class="form-label">Estatus:</label>
                        <input type="text" id="ticket-estatus" name="estatus" class="form-input" placeholder="Ingrese estatus del ticket" required>
                    </div>
                    <div>
                        <label for="ticket-asesor" class="form-label">Asesor que Atiende:</label>
                        <select id="ticket-asesor" name="asesor" class="form-select" required>
                            <option value="">Seleccione un asesor</option>
                        </select>
                    </div>
                    <div>
                        <label for="ticket-empresa" class="form-label">Empresa:</label>
                         <select id="ticket-empresa" name="empresa" class="form-select" required>
                            <option value="">Seleccione una empresa</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="ticket-cancel-button" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>

            <div id="empresa-form" class="bg-white shadow-md rounded-lg p-8 max-w-md mx-auto form-container">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Formulario de Empresa</h2>
                <form id="empresa-main-form" class="space-y-4">
                    <div>
                        <label for="empresa-nombre" class="form-label">Nombre:</label>
                        <input type="text" id="empresa-nombre" name="nombre" class="form-input" placeholder="Ingrese nombre de la empresa" required>
                        <input type="hidden" id="empresa-edit-id">
                    </div>
                    <div>
                        <label for="empresa-direccion" class="form-label">Dirección:</label>
                        <input type="text" id="empresa-direccion" name="direccion" class="form-input" placeholder="Ingrese dirección" required>
                    </div>
                    <div>
                        <label for="empresa-telefono" class="form-label">Teléfono:</label>
                        <input type="tel" id="empresa-telefono" name="telefono" class="form-input" placeholder="Ingrese teléfono" required>
                    </div>
                    <div>
                        <label for="empresa-correo" class="form-label">Correo:</label>
                        <input type="email" id="empresa-correo" name="correo" class="form-input" placeholder="Ingrese correo" required>
                    </div>
                    <div>
                        <label for="empresa-contacto" class="form-label">Nombre de Contacto:</label>
                        <input type="text" id="empresa-contacto" name="contacto" class="form-input" placeholder="Ingrese nombre de contacto" required>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="empresa-cancel-button" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>

            <div id="asesor-form" class="bg-white shadow-md rounded-lg p-8 max-w-md mx-auto form-container">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Formulario de Asesor</h2>
                <form id="asesor-main-form" class="space-y-4">
                    <div>
                        <label for="asesor-nombre" class="form-label">Nombre:</label>
                        <input type="text" id="asesor-nombre" name="nombre" class="form-input" placeholder="Ingrese nombre del asesor" required>
                        <input type="hidden" id="asesor-edit-id">
                    </div>
                    <div>
                        <label for="asesor-telefono" class="form-label">Teléfono:</label>
                        <input type="tel" id="asesor-telefono" name="telefono" class="form-input" placeholder="Ingrese teléfono" required>
                    </div>
                    <div>
                        <label for="asesor-correo" class="form-label">Correo:</label>
                        <input type="email" id="asesor-correo" name="correo" class="form-input" placeholder="Ingrese correo" required>
                    </div>
                    <div>
                        <label for="asesor-numero-trabajador" class="form-label">Número de Trabajador:</label>
                        <input type="text" id="asesor-numero-trabajador" name="numero_trabajador" class="form-input" placeholder="Ingrese número de trabajador" required>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="asesor-cancel-button" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>

            <div id="cliente-form" class="bg-white shadow-md rounded-lg p-8 max-w-md mx-auto form-container">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Formulario de Cliente</h2>
                <form id="cliente-main-form" class="space-y-4">
                    <div>
                        <label for="cliente-nombre" class="form-label">Nombre:</label>
                        <input type="text" id="cliente-nombre" name="nombre" class="form-input" placeholder="Ingrese nombre del cliente" required>
                        <input type="hidden" id="cliente-edit-id">
                    </div>
                    <div>
                        <label for="cliente-correo" class="form-label">Correo:</label>
                        <input type="email" id="cliente-correo" name="correo" class="form-input" placeholder="Ingrese correo" required>
                    </div>
                    <div>
                         <label for="cliente-empresa" class="form-label">Empresa:</label>
                         <select id="cliente-empresa" name="empresa" class="form-select" required>
                            <option value="">Seleccione una empresa</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cliente-cancel-button" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Funciones para mostrar/ocultar páginas
        function showPage(pageId) {
            document.querySelectorAll('.bg-white').forEach(page => page.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
        }

        // Variables globales para almacenar datos
        let tickets = JSON.parse(localStorage.getItem('tickets')) || [];
        let empresas = JSON.parse(localStorage.getItem('empresas')) || [];
        let asesores = JSON.parse(localStorage.getItem('asesores')) || [];
        let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
        let usuarios = JSON.parse(localStorage.getItem('usuarios')) || []; //Para el login

        // Elementos del DOM
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const registerForm = document.getElementById('register-form');
        const registerError = document.getElementById('register-error');
        const ticketsTable = document.getElementById('tickets-table');
        const empresasTable = document.getElementById('empresas-table');
        const asesoresTable = document.getElementById('asesores-table');
        const clientesTable = document.getElementById('clientes-table');
        const addTicketButton = document.getElementById('add-ticket-button');
        const addEmpresaButton = document.getElementById('add-empresa-button');
        const addAsesorButton = document.getElementById('add-asesor-button');
        const addClienteButton = document.getElementById('add-cliente-button');
        const ticketForm = document.getElementById('ticket-form');
        const empresaForm = document.getElementById('empresa-form');
        const asesorForm = document.getElementById('asesor-form');
        const clienteForm = document.getElementById('cliente-form');
        const ticketCancelButton = document.getElementById('ticket-cancel-button');
        const empresaCancelButton = document.getElementById('empresa-cancel-button');
        const asesorCancelButton = document.getElementById('asesor-cancel-button');
        const clienteCancelButton = document.getElementById('cliente-cancel-button');
        const ticketMainForm = document.getElementById('ticket-main-form');
        const empresaMainForm = document.getElementById('empresa-main-form');
        const asesorMainForm = document.getElementById('asesor-main-form');
        const clienteMainForm = document.getElementById('cliente-main-form');
        const goToRegisterButton = document.getElementById('go-to-register');
        const goToLoginButton = document.getElementById('go-to-login');
        const noTicketsMessage = document.getElementById('no-tickets-message');
        const noEmpresasMessage = document.getElementById('no-empresas-message');
        const noAsesoresMessage = document.getElementById('no-asesores-message');
        const noClientesMessage = document.getElementById('no-clientes-message');

        // Inicializar la aplicación
        function init() {
            // Si hay un usuario logueado, mostrar la página de tickets
            if (localStorage.getItem('usuarioLogueado')) {
                showPage('tickets-page');
                loadTickets();
                loadEmpresas();
                loadAsesores();
                loadClientes();
            } else {
                // Si no, mostrar la página de login
                showPage('login-page');
            }

            // Event listeners para los botones de navegación
            addTicketButton.addEventListener('click', () => {
                ticketMainForm.reset();
                document.getElementById('ticket-edit-id').value = "";
                showForm('ticket-form');
            });
            addEmpresaButton.addEventListener('click', () => {
                empresaMainForm.reset();
                document.getElementById('empresa-edit-id').value = "";
                showForm('empresa-form');
            });
            addAsesorButton.addEventListener('click', () => {
                asesorMainForm.reset();
                document.getElementById('asesor-edit-id').value = "";
                showForm('asesor-form');
            });
            addClienteButton.addEventListener('click', () => {
                clienteMainForm.reset();
                document.getElementById('cliente-edit-id').value = "";
                showForm('cliente-form');
            });

            ticketCancelButton.addEventListener('click', () => showPage('tickets-page'));
            empresaCancelButton.addEventListener('click', () => showPage('empresas-page'));
            asesorCancelButton.addEventListener('click', () => showPage('asesores-page'));
            clienteCancelButton.addEventListener('click', () => showPage('clientes-page'));
            goToRegisterButton.addEventListener('click', () => {
                showPage('register-page');
                loginForm.reset();
                loginError.style.display = 'none';
            });

            goToLoginButton.addEventListener('click', () => {
                showPage('login-page');
                registerForm.reset();
                registerError.style.display = 'none';
            });

            // Event listeners para los formularios
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            ticketMainForm.addEventListener('submit', handleTicketSubmit);
            empresaMainForm.addEventListener('submit', handleEmpresaSubmit);
            asesorMainForm.addEventListener('submit', handleAsesorSubmit);
            clienteMainForm.addEventListener('submit', handleClienteSubmit);
        }

        // Función para mostrar formularios
        function showForm(formId) {
            document.querySelectorAll('.bg-white').forEach(page => page.style.display = 'none');
            document.getElementById('entity-forms').style.display = 'block';
            document.getElementById(formId).style.display = 'block';
        }

        // Función para manejar el inicio de sesión
        function handleLogin(event) {
            event.preventDefault();
            const username = event.target.username.value;
            const password = event.target.password.value;

            const usuario = usuarios.find(u => u.username === username && u.password === password);
            if (usuario) {
                localStorage.setItem('usuarioLogueado', username);
                showPage('tickets-page');
                loadTickets();
                loadEmpresas();
                loadAsesores();
                loadClientes();
                loginError.style.display = 'none';
            } else {
                loginError.textContent = 'Usuario o contraseña incorrectos.';
                loginError.style.display = 'block';
            }
        }

        // Función para manejar el registro de usuarios
        function handleRegister(event) {
            event.preventDefault();
             const username = event.target.username.value;
            const password = event.target.password.value;
            const nombre = event.target.nombre.value;
            const correo = event.target.correo.value;

            if (!username || !password || !nombre || !correo) {
                registerError.textContent = 'Todos los campos son obligatorios.';
                registerError.style.display = 'block';
                return;
            }

            const usuarioExistente = usuarios.find(u => u.username === username);
            if (usuarioExistente) {
                registerError.textContent = 'El usuario ya existe.';
                registerError.style.display = 'block';
                return;
            }

            const nuevoUsuario = { username, password, nombre, correo };
            usuarios.push(nuevoUsuario);
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            registerError.style.display = 'none';
            alert('Registro exitoso. Ahora puedes iniciar sesión.');
            showPage('login-page');
        }

        // Funciones para cargar datos en las tablas
        function loadTickets() {
            if (tickets.length === 0) {
                ticketsTable.classList.add('hidden');
                noTicketsMessage.classList.remove('hidden');
            } else {
                ticketsTable.classList.remove('hidden');
                noTicketsMessage.classList.add('hidden');
                const ticketsTableBody = ticketsTable.querySelector('tbody');
                ticketsTableBody.innerHTML = '';
                tickets.forEach(ticket => {
                    const row = ticketsTableBody.insertRow();
                    const idCell = row.insertCell();
                    const tipoCell = row.insertCell();
                    const reportaCell = row.insertCell();
                    const fechaCell = row.insertCell();
                    const estatusCell = row.insertCell();
                    const asesorCell = row.insertCell();
                    const empresaCell = row.insertCell();
                    const accionesCell = row.insertCell();

                    idCell.textContent = ticket.id;
                    tipoCell.textContent = ticket.tipo;
                    reportaCell.textContent = ticket.reporta;
                    fechaCell.textContent = ticket.fecha;
                    estatusCell.textContent = ticket.estatus;
                    asesorCell.textContent = ticket.asesorNombre; // Mostrar el nombre del asesor
                    empresaCell.textContent = ticket.empresaNombre; // Mostrar el nombre de la empresa

                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.className = 'btn-outline-primary mr-2';
                    editButton.addEventListener('click', () => {
                        document.getElementById('ticket-edit-id').value = ticket.id;
                        document.getElementById('ticket-tipo').value = ticket.tipo;
                        document.getElementById('ticket-reporta').value = ticket.reporta;
                        document.getElementById('ticket-fecha').value = ticket.fecha;
                        document.getElementById('ticket-estatus').value = ticket.estatus;
                        document.getElementById('ticket-asesor').value = ticket.asesorId;
                        document.getElementById('ticket-empresa').value = ticket.empresaId;
                        showForm('ticket-form');
                    });
                    accionesCell.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Borrar';
                    deleteButton.className = 'btn-outline-danger';
                    deleteButton.addEventListener('click', () => {
                        tickets = tickets.filter(t => t.id !== ticket.id);
                        localStorage.setItem('tickets', JSON.stringify(tickets));
                        loadTickets();
                    });
                    accionesCell.appendChild(deleteButton);
                });
            }
        }

        function loadEmpresas() {
            if (empresas.length === 0) {
                empresasTable.classList.add('hidden');
                noEmpresasMessage.classList.remove('hidden');
            } else {
                empresasTable.classList.remove('hidden');
                noEmpresasMessage.classList.add('hidden');
                const empresasTableBody = empresasTable.querySelector('tbody');
                empresasTableBody.innerHTML = '';
                empresas.forEach(empresa => {
                    const row = empresasTableBody.insertRow();
                    const nombreCell = row.insertCell();
                    const direccionCell = row.insertCell();
                    const telefonoCell = row.insertCell();
                    const correoCell = row.insertCell();
                    const contactoCell = row.insertCell();
                    const accionesCell = row.insertCell();

                    nombreCell.textContent = empresa.nombre;
                    direccionCell.textContent = empresa.direccion;
                    telefonoCell.textContent = empresa.telefono;
                    correoCell.textContent = empresa.correo;
                    contactoCell.textContent = empresa.contacto;

                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.className = 'btn-outline-primary mr-2';
                    editButton.addEventListener('click', () => {
                        document.getElementById('empresa-edit-id').value = empresa.id;
                        document.getElementById('empresa-nombre').value = empresa.nombre;
                        document.getElementById('empresa-direccion').value = empresa.direccion;
                        document.getElementById('empresa-telefono').value = empresa.telefono;
                        document.getElementById('empresa-correo').value = empresa.correo;
                        document.getElementById('empresa-contacto').value = empresa.contacto;
                        showForm('empresa-form');
                    });
                    accionesCell.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Borrar';
                    deleteButton.className = 'btn-outline-danger';
                    deleteButton.addEventListener('click', () => {
                        empresas = empresas.filter(e => e.id !== empresa.id);
                        localStorage.setItem('empresas', JSON.stringify(empresas));
                        loadEmpresas();
                         // Actualizar las opciones de selección de empresa en los formularios de Ticket y Cliente
                        updateEmpresaOptions();
                    });
                    accionesCell.appendChild(deleteButton);
                });
            }
        }

        function loadAsesores() {
            if (asesores.length === 0) {
                asesoresTable.classList.add('hidden');
                noAsesoresMessage.classList.remove('hidden');
            } else {
                asesoresTable.classList.remove('hidden');
                noAsesoresMessage.classList.add('hidden');
                const asesoresTableBody = asesoresTable.querySelector('tbody');
                asesoresTableBody.innerHTML = '';
                asesores.forEach(asesor => {
                    const row = asesoresTableBody.insertRow();
                    const nombreCell = row.insertCell();
                    const telefonoCell = row.insertCell();
                    const correoCell = row.insertCell();
                    const numeroTrabajadorCell = row.insertCell();
                    const accionesCell = row.insertCell();

                    nombreCell.textContent = asesor.nombre;
                    telefonoCell.textContent = asesor.telefono;
                    correoCell.textContent = asesor.correo;
                    numeroTrabajadorCell.textContent = asesor.numero_trabajador;

                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.className = 'btn-outline-primary mr-2';
                    editButton.addEventListener('click', () => {
                        document.getElementById('asesor-edit-id').value = asesor.id;
                        document.getElementById('asesor-nombre').value = asesor.nombre;
                        document.getElementById('asesor-telefono').value = asesor.telefono;
                        document.getElementById('asesor-correo').value = asesor.correo;
                        document.getElementById('asesor-numero-trabajador').value = asesor.numero_trabajador;
                        showForm('asesor-form');
                    });
                    accionesCell.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Borrar';
                    deleteButton.className = 'btn-outline-danger';
                    deleteButton.addEventListener('click', () => {
                        asesores = asesores.filter(a => a.id !== asesor.id);
                        localStorage.setItem('asesores', JSON.stringify(asesores));
                        loadAsesores();
                        // Actualizar las opciones de selección de asesor en el formulario de Ticket
                        updateAsesorOptions();
                    });
                    accionesCell.appendChild(deleteButton);
                });
            }
        }

        function loadClientes() {
            if (clientes.length === 0) {
                clientesTable.classList.add('hidden');
                noClientesMessage.classList.remove('hidden');
            } else {
                clientesTable.classList.remove('hidden');
                noClientesMessage.classList.add('hidden');
                const clientesTableBody = clientesTable.querySelector('tbody');
                clientesTableBody.innerHTML = '';
                clientes.forEach(cliente => {
                    const row = clientesTableBody.insertRow();
                    const nombreCell = row.insertCell();
                    const correoCell = row.insertCell();
                    const empresaCell = row.insertCell();
                    const accionesCell = row.insertCell();

                    nombreCell.textContent = cliente.nombre;
                    correoCell.textContent = cliente.correo;
                    empresaCell.textContent = cliente.empresaNombre;

                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.className = 'btn-outline-primary mr-2';
                    editButton.addEventListener('click', () => {
                        document.getElementById('cliente-edit-id').value = cliente.id;
                        document.getElementById('cliente-nombre').value = cliente.nombre;
                        document.getElementById('cliente-correo').value = cliente.correo;
                        document.getElementById('cliente-empresa').value = cliente.empresaId;
                        showForm('cliente-form');
                    });
                    accionesCell.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Borrar';
                    deleteButton.className = 'btn-outline-danger';
                    deleteButton.addEventListener('click', () => {
                        clientes = clientes.filter(c => c.id !== cliente.id);
                        localStorage.setItem('clientes', JSON.stringify(clientes));
                        loadClientes();
                    });
                    accionesCell.appendChild(deleteButton);
                });
            }
        }

        // Funciones para manejar el envío de formularios
        function handleTicketSubmit(event) {
            event.preventDefault();

            const id = document.getElementById('ticket-id').value;
            const tipo = document.getElementById('ticket-tipo').value;
            const reporta = document.getElementById('ticket-reporta').value;
            const fecha = document.getElementById('ticket-fecha').value;
            const estatus = document.getElementById('ticket-estatus').value;
            const asesorId = document.getElementById('ticket-asesor').value;
            const empresaId = document.getElementById('ticket-empresa').value;
             // Obtener el nombre del asesor y la empresa
            const asesorObj = asesores.find(a => a.id === asesorId);
            const empresaObj = empresas.find(e => e.id === empresaId);
            const asesorNombre = asesorObj ? asesorObj.nombre : '';
            const empresaNombre = empresaObj ? empresaObj.nombre : '';

            if (!id || !tipo || !reporta || !fecha || !estatus || !asesorId || !empresaId) {
                alert('Todos los campos son obligatorios.');
                return;
            }

            const editId = document.getElementById('ticket-edit-id').value;
            if (editId) {
                // Actualizar ticket existente
                const index = tickets.findIndex(t => t.id === editId);
                if (index !== -1) {
                    tickets[index] = { id, tipo, reporta, fecha, estatus, asesorId, asesorNombre, empresaId, empresaNombre };
                }
            } else {
                // Crear nuevo ticket
                const nuevoTicket = { id, tipo, reporta, fecha, estatus, asesorId, asesorNombre, empresaId, empresaNombre };
                tickets.push(nuevoTicket);
            }
            localStorage.setItem('tickets', JSON.stringify(tickets));
            showPage('tickets-page');
            loadTickets();
            ticketMainForm.reset();
        }

        function handleEmpresaSubmit(event) {
            event.preventDefault();
            const id = document.getElementById('empresa-edit-id').value;
            const nombre = event.target.nombre.value;
            const direccion = event.target.direccion.value;
            const telefono = event.target.telefono.value;
            const correo = event.target.correo.value;
            const contacto = event.target.contacto.value;

             if (!nombre || !direccion || !telefono || !correo || !contacto) {
                alert('Todos los campos son obligatorios.');
                return;
            }

            if (id) {
                // Actualizar empresa existente
                const index = empresas.findIndex(e => e.id === id);
                if (index !== -1) {
                    empresas[index] = { id, nombre, direccion, telefono, correo, contacto };
                }
            } else {
                // Crear nueva empresa
                const nuevaEmpresa = {
                    id: Date.now().toString(), // Usar timestamp como ID
                    nombre,
                    direccion,
                    telefono,
                    correo,
                    contacto
                };
                empresas.push(nuevaEmpresa);
            }
            localStorage.setItem('empresas', JSON.stringify(empresas));
            showPage('empresas-page');
            loadEmpresas();
             // Actualizar las opciones de selección de empresa en los formularios de Ticket y Cliente
            updateEmpresaOptions();
            empresaMainForm.reset();
        }

        function handleAsesorSubmit(event) {
            event.preventDefault();
            const id = document.getElementById('asesor-edit-id').value;
            const nombre = event.target.nombre.value;
            const telefono = event.target.telefono.value;
            const correo = event.target.correo.value;
            const numero_trabajador = event.target.numero_trabajador.value;

            if (!nombre || !telefono || !correo || !numero_trabajador) {
                alert('Todos los campos son obligatorios.');
                return;
            }

            if (id) {
                // Actualizar asesor existente
                const index = asesores.findIndex(a => a.id === id);
                if (index !== -1) {
                    asesores[index] = { id, nombre, telefono, correo, numero_trabajador };
                }
            } else {
                // Crear nuevo asesor
                const nuevoAsesor = {
                    id: Date.now().toString(), // Usar timestamp como ID
                    nombre,
                    telefono,
                    correo,
                    numero_trabajador
                };
                asesores.push(nuevoAsesor);
            }
            localStorage.setItem('asesores', JSON.stringify(asesores));
            showPage('asesores-page');
            loadAsesores();
            // Actualizar las opciones de selección de asesor en el formulario de Ticket
            updateAsesorOptions();
            asesorMainForm.reset();
        }

        function handleClienteSubmit(event) {
            event.preventDefault();
            const id = document.getElementById('cliente-edit-id').value;
            const nombre = event.target.nombre.value;
            const correo = event.target.correo.value;
            const empresaId = document.getElementById('cliente-empresa').value;
             // Obtener el nombre de la empresa
            const empresaObj = empresas.find(e => e.id === empresaId);
            const empresaNombre = empresaObj ? empresaObj.nombre : '';

            if (!nombre || !correo || !empresaId) {
                alert('Todos los campos son obligatorios.');
                return;
            }

            if (id) {
                // Actualizar cliente existente
                const index = clientes.findIndex(c => c.id === id);
                if (index !== -1) {
                    clientes[index] = { id, nombre, correo, empresaId, empresaNombre };
                }
            } else {
                // Crear nuevo cliente
                const nuevoCliente = {
                    id: Date.now().toString(), // Usar timestamp como ID
                    nombre,
                    correo,
                    empresaId,
                    empresaNombre
                };
                clientes.push(nuevoCliente);
            }
            localStorage.setItem('clientes', JSON.stringify(clientes));
            showPage('clientes-page');
            loadClientes();
            clienteMainForm.reset();
        }

        // Función para actualizar las opciones del select de Asesores en el formulario de Tickets
        function updateAsesorOptions() {
            const ticketAsesorSelect = document.getElementById('ticket-asesor');
            ticketAsesorSelect.innerHTML = '<option value="">Seleccione un asesor</option>'; // Limpiar opciones anteriores
            asesores.forEach(asesor => {
                const option = document.createElement('option');
                option.value = asesor.id;
                option.textContent = asesor.nombre;
                ticketAsesorSelect.appendChild(option);
            });
        }

        // Función para actualizar las opciones del select de Empresas en el formulario de Tickets y Clientes
        function updateEmpresaOptions() {
            const ticketEmpresaSelect = document.getElementById('ticket-empresa');
            const clienteEmpresaSelect = document.getElementById('cliente-empresa');

            ticketEmpresaSelect.innerHTML = '<option value="">Seleccione una empresa</option>'; // Limpiar opciones anteriores
            clienteEmpresaSelect.innerHTML = '<option value="">Seleccione una empresa</option>'; // Limpiar opciones anteriores

            empresas.forEach(empresa => {
                const optionTicket = document.createElement('option');
                optionTicket.value = empresa.id;
                optionTicket.textContent = empresa.nombre;
                ticketEmpresaSelect.appendChild(optionTicket);

                const optionCliente = document.createElement('option');
                optionCliente.value = empresa.id;
                optionCliente.textContent = empresa.nombre;
                clienteEmpresaSelect.appendChild(optionCliente);
            });
        }

        // Inicializar la aplicación
        init();
    </script>
</body>
</html>
